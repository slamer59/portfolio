---
title: "ArgoCD GitOps Architecture: Multi-Tenant Kubernetes"
slug: "argocd-dagster-gitops-production"
date: "2025-03-20T10:00:00.000Z"
summary: "Build scalable multi-tenant GitOps with ArgoCD and Dagster. Automate Kubernetes deployments, reduce deploy time from 2h to 5min with zero-downtime."
author: "Thomas Pedot"
technologies: ["ArgoCD", "Kubernetes", "Helm", "GitOps", "Git"]
published: true
featured: true
keywords: ["gitops architecture", "argocd multi-tenant", "kubernetes deployment", "dagster infrastructure", "continuous deployment"]
type: "article"
github: "https://github.com/slamer59/dagster-argocd-configuration"
pillarPage: "cloud-native-devops-expertise"
pillarTitle: "Kubernetes Production & DevOps: Helm, GitOps, ArgoCD"
---

> ğŸ“š Part of the [Cloud Native & DevOps Expertise](/articles/cloud-native-devops-expertise) series

## GitOps Multi-Tenant Architecture Overview

```mermaid
graph LR
    subgraph "Developer Experience"
        DEV[ğŸ‘¨â€ğŸ’» Developer]
    end

    subgraph "Git Repositories"
        GIT1[ğŸ“ tenant-configs]
        GIT2[ğŸ“¦ helm-charts]
        GIT3[âš™ï¸ argocd-apps]
    end

    subgraph "ArgoCD Control Plane"
        ARGO[ğŸ”„ ArgoCD<br/>ApplicationSet]
        SYNC[ğŸ” Auto Sync]
    end

    subgraph "Kubernetes Cluster"
        NS1[ğŸ“¦ Namespace: team-analytics<br/>Dagster + PostgreSQL]
        NS2[ğŸ“¦ Namespace: team-ml<br/>Dagster + PostgreSQL]
        NS3[ğŸ“¦ Namespace: team-data<br/>Dagster + PostgreSQL]
    end

    DEV -->|git push| GIT1
    GIT1 -->|watches| ARGO
    GIT2 -->|references| ARGO
    GIT3 -->|defines| ARGO

    ARGO -->|generates| SYNC
    SYNC -->|deploys| NS1
    SYNC -->|deploys| NS2
    SYNC -->|deploys| NS3

```

**Architecture GitOps Multi-Tenant:** 1 git push â†’ ArgoCD dÃ©tecte â†’ DÃ©ploie automatiquement 3 tenants isolÃ©s en 5 minutes

## GitOps : Au-DelÃ  du Buzzword

GitOps n'est pas qu'un terme Ã  la mode. C'est une mÃ©thodologie rÃ©volutionnaire qui transforme la faÃ§on dont nous gÃ©rons l'infrastructure et les dÃ©ploiements.

### DÃ©finition GitOps

1. **Git comme source de vÃ©ritÃ©**
2. **DÃ©ploiement dÃ©claratif**
3. **Synchronisation automatique**
4. **TraÃ§abilitÃ© complÃ¨te**

## Le DÃ©fi : DÃ©ploiements Multi-Tenant

Comment dÃ©ployer et gÃ©rer plusieurs environnements de donnÃ©es (tenants) avec :
- Isolation complÃ¨te
- Configuration dynamique
- ZÃ©ro intervention manuelle
- SÃ©curitÃ© renforcÃ©e

## Notre Architecture

### Structure des Repositories

```mermaid
graph TB
    subgraph "1. argocd-apps (Config Repo)"
        A1[applicationset.yaml]
        A2[apps/dagster-tenant-1.yaml]
        A3[apps/dagster-tenant-2.yaml]
    end

    subgraph "2. helm-charts (Charts Repo)"
        B1[dagster/Chart.yaml]
        B2[dagster/values.yaml]
        B3[dagster/templates/]
        B4[monitoring/]
    end

    subgraph "3. tenant-configs (Values Repo)"
        C1[team-analytics/values.yaml]
        C2[team-ml/values.yaml]
        C3[team-data/values.yaml]
    end

    A1 -->|watches| C1
    A1 -->|watches| C2
    A1 -->|watches| C3
    A2 -->|references| B1
    A2 -->|overrides with| C1
    A3 -->|references| B1
    A3 -->|overrides with| C2

```

**3 repositories dÃ©couplÃ©s:**
1. **argocd-apps/** - ApplicationSets et Applications ArgoCD
2. **helm-charts/** - Charts Helm rÃ©utilisables
3. **tenant-configs/** - Configurations spÃ©cifiques par Ã©quipe

### ApplicationSet Multi-Tenant

```yaml
# argocd-apps/applicationset.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: dagster-tenants
spec:
  generators:
    - git:
        repoURL: https://github.com/slamer59/tenant-configs
        revision: main
        directories:
          - path: '*'  # Un dossier = un tenant

  template:
    metadata:
      name: 'dagster-{{path.basename}}'
    spec:
      project: default
      source:
        repoURL: https://github.com/slamer59/helm-charts
        targetRevision: main
        path: dagster
        helm:
          valueFiles:
            - https://github.com/slamer59/tenant-configs/{{path.basename}}/values.yaml
      destination:
        server: https://kubernetes.default.svc
        namespace: 'dagster-{{path.basename}}'
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
```

## Isolation Multi-Tenant

### Architecture d'Isolation

```mermaid
graph TB
    subgraph "Kubernetes Cluster"
        subgraph "Namespace: dagster-team-analytics"
            A1[Dagster Webserver]
            A2[Dagster Daemon]
            A3[PostgreSQL]
            A4["ResourceQuota<br/>CPU: 10 cores<br/>Memory: 40Gi"]
            A5["NetworkPolicy<br/>Isolated"]
        end

        subgraph "Namespace: dagster-team-ml"
            B1[Dagster Webserver]
            B2[Dagster Daemon]
            B3[PostgreSQL]
            B4["ResourceQuota<br/>CPU: 20 cores<br/>Memory: 80Gi"]
            B5["NetworkPolicy<br/>Isolated"]
        end

        subgraph "Namespace: dagster-team-data"
            C1[Dagster Webserver]
            C2[Dagster Daemon]
            C3[PostgreSQL]
            C4["ResourceQuota<br/>CPU: 15 cores<br/>Memory: 60Gi"]
            C5["NetworkPolicy<br/>Isolated"]
        end

        subgraph "Shared Services"
            D1[Monitoring Stack]
            D2[ArgoCD]
        end
    end

    A5 -.->|blocked| B1
    A5 -.->|blocked| C1
    B5 -.->|blocked| C1

    A1 -->|allowed| D1
    B1 -->|allowed| D1
    C1 -->|allowed| D1

    D2 -->|manages| A1
    D2 -->|manages| B1
    D2 -->|manages| C1

```

**3 niveaux d'isolation:**
1. **Namespace Kubernetes** - Isolation logique
2. **ResourceQuota** - Limites CPU/Memory par tenant
3. **NetworkPolicy** - Isolation rÃ©seau stricte

### Configuration Kubernetes

```yaml
# Namespace dÃ©diÃ©
apiVersion: v1
kind: Namespace
metadata:
  name: dagster-team-analytics
  labels:
    tenant: team-analytics

---
# Resource Quotas
apiVersion: v1
kind: ResourceQuota
metadata:
  name: tenant-quota
  namespace: dagster-team-analytics
spec:
  hard:
    requests.cpu: "10"
    requests.memory: "40Gi"
    persistentvolumeclaims: "10"

---
# Network Policy (isolation stricte)
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: tenant-isolation
  namespace: dagster-team-analytics
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - podSelector: {}  # Autoriser uniquement au sein du namespace
  egress:
    - to:
      - podSelector: {}
    - to:  # Autoriser accÃ¨s PostgreSQL partagÃ©
      - namespaceSelector:
          matchLabels:
            name: databases
```

## Workflow DÃ©veloppeur

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant Git as Git Repository
    participant ArgoCD as ArgoCD
    participant K8s as Kubernetes Cluster

    Dev->>Git: 1. git push (new tenant config)
    Note over Dev,Git: tenant-configs/team-sales/values.yaml

    Git-->>ArgoCD: 2. Webhook notification (< 5s)
    ArgoCD->>Git: 3. Pull latest config
    ArgoCD->>ArgoCD: 4. Detect changes (ApplicationSet)

    ArgoCD->>K8s: 5. Create namespace dagster-team-sales
    ArgoCD->>K8s: 6. Apply ResourceQuota + NetworkPolicy
    ArgoCD->>K8s: 7. Deploy Dagster (Helm)
    K8s-->>ArgoCD: 8. Health check (Healthy)

    Note over Dev,K8s: Total time: ~5 minutes (was 2 hours manual)
```

**Steps dÃ©taillÃ©s:**

```bash
# 1. CrÃ©er un nouveau tenant
mkdir tenant-configs/team-sales
cp tenant-configs/_template/values.yaml tenant-configs/team-sales/

# 2. Personnaliser la configuration
vim tenant-configs/team-sales/values.yaml

# 3. Commit & Push
git add tenant-configs/team-sales/
git commit -m "Add team-sales tenant"
git push origin main

# 4. ArgoCD dÃ©tecte automatiquement (< 30s)
# â†’ CrÃ©e Application ArgoCD automatiquement
# â†’ DÃ©ploie Dagster dans namespace dagster-team-sales
# â†’ ~3min plus tard: tenant opÃ©rationnel âœ…
```

## MÃ©triques de Performance

### Avant l'Architecture GitOps

- DÃ©ploiement manuel : **2 heures**
- Provisioning tenant : Intervention humaine requise
- Taux de dÃ©ploiement : 5-10 par semaine
- Rollback : Complexe, risquÃ©

### AprÃ¨s l'Architecture GitOps

- DÃ©ploiement automatique : **5 minutes**
- Provisioning tenant : ZÃ©ro intervention
- Taux de dÃ©ploiement : 50+ par jour
- Rollback : Simple, instantanÃ© (git revert)

**Statistiques ClÃ©s:**
- 5 tenants actifs
- 99.5% de dÃ©ploiements rÃ©ussis
- Temps moyen de rollback : 45 secondes

## Related Cloud Native Articles

- [Helm Chart Visualization Tool](/articles/helm-chart-visualization-tool) - MaÃ®triser les dÃ©pendances Helm
- [Edge Computing with Jetson Xavier](/articles/edge-computing-docker-jetson-xavier) - Optimisation Docker pour ARM64

## Technologies ClÃ©s

- **ArgoCD** : Synchronisation Git â†’ Kubernetes
- **Helm** : Templating de charts
- **Kubernetes** : Orchestration
- **Mustache** : Templating dynamique
- **Git** : Source de vÃ©ritÃ©

## Lessons Learned

1. **Automatisation totale** : Moins de tÃ¢ches manuelles = moins d'erreurs
2. **Isolation par dÃ©faut** : SÃ©curitÃ© intÃ©grÃ©e, pas ajoutÃ©e aprÃ¨s coup
3. **Configuration as Code** : TraÃ§abilitÃ© et reproductibilitÃ©

## Conclusion

Cette architecture GitOps n'est pas qu'une solution technique. C'est une transformation culturelle : dÃ©ployer devient un acte de configuration, pas d'intervention.

<ViewRepository url="https://github.com/slamer59/dagster-argocd-configuration" text="Voir le projet sur GitHub" />

---

**Explorez tous mes projets Cloud Native â†’** [Cloud Native & DevOps Hub](/articles/cloud-native-devops-expertise)
